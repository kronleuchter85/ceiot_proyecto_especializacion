{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "iot_lakehouse": {
            "type": "string"
        },
        "iot_warehouse": {
            "type": "string"
        }
    },
    "variables": {},
    "resources": [
        {
            "name": "dp-import-and-process",
            "type": "pipelines",
            "apiVersion": "2018-06-01",
            "properties": {
                "activities": [
                    {
                        "name": "Lakehouse Import Readings",
                        "type": "Copy",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "0.12:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "typeProperties": {
                            "source": {
                                "type": "JsonSource",
                                "storeSettings": {
                                    "type": "LakehouseReadSettings",
                                    "recursive": true,
                                    "enablePartitionDiscovery": false
                                },
                                "formatSettings": {
                                    "type": "JsonReadSettings"
                                },
                                "datasetSettings": {
                                    "annotations": [],
                                    "linkedService": {
                                        "name": "iot_lakehouse",
                                        "properties": {
                                            "annotations": [],
                                            "type": "Lakehouse",
                                            "typeProperties": {
                                                "workspaceId": "81312666-c3bb-44e3-8440-2a9d4e96896a",
                                                "artifactId": "[parameters('iot_lakehouse')]",
                                                "rootFolder": "Files"
                                            }
                                        }
                                    },
                                    "type": "Json",
                                    "typeProperties": {
                                        "location": {
                                            "type": "LakehouseLocation",
                                            "folderPath": "bronze_readings"
                                        }
                                    },
                                    "schema": {}
                                }
                            },
                            "sink": {
                                "type": "LakehouseTableSink",
                                "tableActionOption": "OverwriteSchema",
                                "partitionOption": "None",
                                "datasetSettings": {
                                    "annotations": [],
                                    "linkedService": {
                                        "name": "iot_lakehouse",
                                        "properties": {
                                            "annotations": [],
                                            "type": "Lakehouse",
                                            "typeProperties": {
                                                "workspaceId": "81312666-c3bb-44e3-8440-2a9d4e96896a",
                                                "artifactId": "[parameters('iot_lakehouse')]",
                                                "rootFolder": "Tables"
                                            }
                                        }
                                    },
                                    "type": "LakehouseTable",
                                    "schema": [],
                                    "typeProperties": {
                                        "schema": "iot_bronze",
                                        "table": "readings"
                                    }
                                }
                            },
                            "enableStaging": false,
                            "translator": {
                                "type": "TabularTranslator",
                                "typeConversion": true,
                                "typeConversionSettings": {
                                    "allowDataTruncation": true,
                                    "treatBooleanAsNumber": false
                                },
                                "columnFlattenSettings": {
                                    "treatArrayAsString": false,
                                    "treatStructAsString": false,
                                    "flattenColumnDelimiter": "."
                                }
                            }
                        }
                    },
                    {
                        "name": "Lakehouse Import Transactions",
                        "type": "Copy",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "0.12:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "typeProperties": {
                            "source": {
                                "type": "JsonSource",
                                "storeSettings": {
                                    "type": "LakehouseReadSettings",
                                    "recursive": true,
                                    "enablePartitionDiscovery": false
                                },
                                "formatSettings": {
                                    "type": "JsonReadSettings"
                                },
                                "datasetSettings": {
                                    "annotations": [],
                                    "linkedService": {
                                        "name": "iot_lakehouse",
                                        "properties": {
                                            "annotations": [],
                                            "type": "Lakehouse",
                                            "typeProperties": {
                                                "workspaceId": "81312666-c3bb-44e3-8440-2a9d4e96896a",
                                                "artifactId": "[parameters('iot_lakehouse')]",
                                                "rootFolder": "Files"
                                            }
                                        }
                                    },
                                    "type": "Json",
                                    "typeProperties": {
                                        "location": {
                                            "type": "LakehouseLocation",
                                            "folderPath": "bronze_transactions"
                                        }
                                    },
                                    "schema": {}
                                }
                            },
                            "sink": {
                                "type": "LakehouseTableSink",
                                "tableActionOption": "OverwriteSchema",
                                "partitionOption": "None",
                                "datasetSettings": {
                                    "annotations": [],
                                    "linkedService": {
                                        "name": "iot_lakehouse",
                                        "properties": {
                                            "annotations": [],
                                            "type": "Lakehouse",
                                            "typeProperties": {
                                                "workspaceId": "81312666-c3bb-44e3-8440-2a9d4e96896a",
                                                "artifactId": "[parameters('iot_lakehouse')]",
                                                "rootFolder": "Tables"
                                            }
                                        }
                                    },
                                    "type": "LakehouseTable",
                                    "schema": [],
                                    "typeProperties": {
                                        "schema": "iot_bronze",
                                        "table": "transactions"
                                    }
                                }
                            },
                            "enableStaging": false,
                            "translator": {
                                "type": "TabularTranslator",
                                "typeConversion": true,
                                "typeConversionSettings": {
                                    "allowDataTruncation": true,
                                    "treatBooleanAsNumber": false
                                },
                                "columnFlattenSettings": {
                                    "treatArrayAsString": false,
                                    "treatStructAsString": false,
                                    "flattenColumnDelimiter": "."
                                }
                            }
                        }
                    },
                    {
                        "name": "Lakehouse Import Contracts",
                        "type": "Copy",
                        "dependsOn": [],
                        "policy": {
                            "timeout": "0.12:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "typeProperties": {
                            "source": {
                                "type": "JsonSource",
                                "storeSettings": {
                                    "type": "LakehouseReadSettings",
                                    "recursive": true,
                                    "enablePartitionDiscovery": false
                                },
                                "formatSettings": {
                                    "type": "JsonReadSettings"
                                },
                                "datasetSettings": {
                                    "annotations": [],
                                    "linkedService": {
                                        "name": "iot_lakehouse",
                                        "properties": {
                                            "annotations": [],
                                            "type": "Lakehouse",
                                            "typeProperties": {
                                                "workspaceId": "81312666-c3bb-44e3-8440-2a9d4e96896a",
                                                "artifactId": "[parameters('iot_lakehouse')]",
                                                "rootFolder": "Files"
                                            }
                                        }
                                    },
                                    "type": "Json",
                                    "typeProperties": {
                                        "location": {
                                            "type": "LakehouseLocation",
                                            "folderPath": "bronze_contracts"
                                        }
                                    },
                                    "schema": {}
                                }
                            },
                            "sink": {
                                "type": "LakehouseTableSink",
                                "tableActionOption": "OverwriteSchema",
                                "partitionOption": "None",
                                "datasetSettings": {
                                    "annotations": [],
                                    "linkedService": {
                                        "name": "iot_lakehouse",
                                        "properties": {
                                            "annotations": [],
                                            "type": "Lakehouse",
                                            "typeProperties": {
                                                "workspaceId": "81312666-c3bb-44e3-8440-2a9d4e96896a",
                                                "artifactId": "[parameters('iot_lakehouse')]",
                                                "rootFolder": "Tables"
                                            }
                                        }
                                    },
                                    "type": "LakehouseTable",
                                    "schema": [],
                                    "typeProperties": {
                                        "schema": "iot_bronze",
                                        "table": "contracts"
                                    }
                                }
                            },
                            "enableStaging": false,
                            "translator": {
                                "type": "TabularTranslator",
                                "typeConversion": true,
                                "typeConversionSettings": {
                                    "allowDataTruncation": true,
                                    "treatBooleanAsNumber": false
                                },
                                "columnFlattenSettings": {
                                    "treatArrayAsString": false,
                                    "treatStructAsString": false,
                                    "flattenColumnDelimiter": "."
                                }
                            }
                        }
                    },
                    {
                        "name": "Clean Transform Normalize",
                        "type": "RefreshDataflow",
                        "dependsOn": [
                            {
                                "activity": "Lakehouse Import Readings",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Lakehouse Import Transactions",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            },
                            {
                                "activity": "Lakehouse Import Contracts",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "0.12:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "typeProperties": {
                            "dataflowId": "07f30a23-5c01-4d67-8abe-5a531b9924b9",
                            "workspaceId": "81312666-c3bb-44e3-8440-2a9d4e96896a",
                            "notifyOption": "NoNotification",
                            "dataflowType": "Dataflow-Gen2"
                        }
                    },
                    {
                        "name": "Warehouse Import Transactions",
                        "type": "Copy",
                        "dependsOn": [
                            {
                                "activity": "Semantic Curation",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "0.12:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "typeProperties": {
                            "source": {
                                "type": "LakehouseTableSource",
                                "datasetSettings": {
                                    "annotations": [],
                                    "linkedService": {
                                        "name": "iot_lakehouse",
                                        "properties": {
                                            "annotations": [],
                                            "type": "Lakehouse",
                                            "typeProperties": {
                                                "workspaceId": "81312666-c3bb-44e3-8440-2a9d4e96896a",
                                                "artifactId": "[parameters('iot_lakehouse')]",
                                                "rootFolder": "Tables"
                                            }
                                        }
                                    },
                                    "type": "LakehouseTable",
                                    "schema": [],
                                    "typeProperties": {
                                        "schema": "iot_gold",
                                        "table": "transactions"
                                    }
                                }
                            },
                            "sink": {
                                "type": "DataWarehouseSink",
                                "allowCopyCommand": true,
                                "copyCommandSettings": {},
                                "tableOption": "autoCreate",
                                "datasetSettings": {
                                    "annotations": [],
                                    "linkedService": {
                                        "name": "iot_warehouse",
                                        "properties": {
                                            "annotations": [],
                                            "type": "DataWarehouse",
                                            "typeProperties": {
                                                "endpoint": "exrtvvz4lmlevnmuld27dg2giy-mytddan3yprujbcafkou5fujni.datawarehouse.fabric.microsoft.com",
                                                "artifactId": "[parameters('iot_warehouse')]",
                                                "workspaceId": "81312666-c3bb-44e3-8440-2a9d4e96896a"
                                            }
                                        }
                                    },
                                    "type": "DataWarehouseTable",
                                    "schema": [],
                                    "typeProperties": {
                                        "schema": "iot_gold",
                                        "table": "transactions"
                                    }
                                }
                            },
                            "enableStaging": true,
                            "translator": {
                                "type": "TabularTranslator",
                                "typeConversion": true,
                                "typeConversionSettings": {
                                    "allowDataTruncation": true,
                                    "treatBooleanAsNumber": false
                                }
                            }
                        }
                    },
                    {
                        "name": "Warehouse Import Readings",
                        "type": "Copy",
                        "dependsOn": [
                            {
                                "activity": "Semantic Curation",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "0.12:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "typeProperties": {
                            "source": {
                                "type": "LakehouseTableSource",
                                "datasetSettings": {
                                    "annotations": [],
                                    "linkedService": {
                                        "name": "iot_lakehouse",
                                        "properties": {
                                            "annotations": [],
                                            "type": "Lakehouse",
                                            "typeProperties": {
                                                "workspaceId": "81312666-c3bb-44e3-8440-2a9d4e96896a",
                                                "artifactId": "[parameters('iot_lakehouse')]",
                                                "rootFolder": "Tables"
                                            }
                                        }
                                    },
                                    "type": "LakehouseTable",
                                    "schema": [],
                                    "typeProperties": {
                                        "schema": "iot_gold",
                                        "table": "readings"
                                    }
                                }
                            },
                            "sink": {
                                "type": "DataWarehouseSink",
                                "allowCopyCommand": true,
                                "copyCommandSettings": {},
                                "tableOption": "autoCreate",
                                "datasetSettings": {
                                    "annotations": [],
                                    "linkedService": {
                                        "name": "iot_warehouse",
                                        "properties": {
                                            "annotations": [],
                                            "type": "DataWarehouse",
                                            "typeProperties": {
                                                "endpoint": "exrtvvz4lmlevnmuld27dg2giy-mytddan3yprujbcafkou5fujni.datawarehouse.fabric.microsoft.com",
                                                "artifactId": "[parameters('iot_warehouse')]",
                                                "workspaceId": "81312666-c3bb-44e3-8440-2a9d4e96896a"
                                            }
                                        }
                                    },
                                    "type": "DataWarehouseTable",
                                    "schema": [],
                                    "typeProperties": {
                                        "schema": "iot_gold",
                                        "table": "readings"
                                    }
                                }
                            },
                            "enableStaging": true,
                            "translator": {
                                "type": "TabularTranslator",
                                "typeConversion": true,
                                "typeConversionSettings": {
                                    "allowDataTruncation": true,
                                    "treatBooleanAsNumber": false
                                }
                            }
                        }
                    },
                    {
                        "name": "Warehouse Import Contracts",
                        "type": "Copy",
                        "dependsOn": [
                            {
                                "activity": "Semantic Curation",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "0.12:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "typeProperties": {
                            "source": {
                                "type": "LakehouseTableSource",
                                "datasetSettings": {
                                    "annotations": [],
                                    "linkedService": {
                                        "name": "iot_lakehouse",
                                        "properties": {
                                            "annotations": [],
                                            "type": "Lakehouse",
                                            "typeProperties": {
                                                "workspaceId": "81312666-c3bb-44e3-8440-2a9d4e96896a",
                                                "artifactId": "[parameters('iot_lakehouse')]",
                                                "rootFolder": "Tables"
                                            }
                                        }
                                    },
                                    "type": "LakehouseTable",
                                    "schema": [],
                                    "typeProperties": {
                                        "schema": "iot_gold",
                                        "table": "contracts"
                                    }
                                }
                            },
                            "sink": {
                                "type": "DataWarehouseSink",
                                "allowCopyCommand": true,
                                "copyCommandSettings": {},
                                "tableOption": "autoCreate",
                                "datasetSettings": {
                                    "annotations": [],
                                    "linkedService": {
                                        "name": "iot_warehouse",
                                        "properties": {
                                            "annotations": [],
                                            "type": "DataWarehouse",
                                            "typeProperties": {
                                                "endpoint": "exrtvvz4lmlevnmuld27dg2giy-mytddan3yprujbcafkou5fujni.datawarehouse.fabric.microsoft.com",
                                                "artifactId": "[parameters('iot_warehouse')]",
                                                "workspaceId": "81312666-c3bb-44e3-8440-2a9d4e96896a"
                                            }
                                        }
                                    },
                                    "type": "DataWarehouseTable",
                                    "schema": [],
                                    "typeProperties": {
                                        "schema": "iot_gold",
                                        "table": "contracts"
                                    }
                                }
                            },
                            "enableStaging": true,
                            "translator": {
                                "type": "TabularTranslator",
                                "typeConversion": true,
                                "typeConversionSettings": {
                                    "allowDataTruncation": true,
                                    "treatBooleanAsNumber": false
                                }
                            }
                        }
                    },
                    {
                        "name": "Semantic Curation",
                        "type": "TridentNotebook",
                        "dependsOn": [
                            {
                                "activity": "Clean Transform Normalize",
                                "dependencyConditions": [
                                    "Succeeded"
                                ]
                            }
                        ],
                        "policy": {
                            "timeout": "0.12:00:00",
                            "retry": 0,
                            "retryIntervalInSeconds": 30,
                            "secureOutput": false,
                            "secureInput": false
                        },
                        "typeProperties": {
                            "notebookId": "52c15129-5949-4ceb-afea-0945755c5fd7",
                            "workspaceId": "81312666-c3bb-44e3-8440-2a9d4e96896a"
                        }
                    }
                ],
                "lastModifiedByObjectId": "8fa12345-bd24-435b-a888-c7d2b764e146",
                "lastPublishTime": "2025-07-05T06:27:34Z"
            },
            "dependsOn": []
        }
    ]
}